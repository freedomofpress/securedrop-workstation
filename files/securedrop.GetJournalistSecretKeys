#!/bin/bash
# SecureDrop qrexec service: securedrop.GetJournalistSecretKeys
# This service returns the journalist secret keys from the dom0 configuration

set -euo pipefail

# TODO: add support for multiple keys
MAIN_SECRET_KEY_PATH=${MAIN_SECRET_KEY_PATH:-"/usr/share/securedrop-workstation-dom0-config/sd-journalist.sec"}

# Check if the secret keys file exists
if [ ! -f "$MAIN_SECRET_KEY_PATH" ]; then
    # Log errors to systemd journal under the PRC policy's name
    echo "Error: Secret keys file not found: $MAIN_SECRET_KEY_PATH" | \
      systemd-cat --identifier="$(basename "$0")"
    exit 2
fi

# Output the contents of the secret keys file
# This will be sent back to the calling VM via stdout
cat "$MAIN_SECRET_KEY_PATH"
